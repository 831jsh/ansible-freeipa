---
# tasks to uninstall IPA server

- name: Uninstall - Include Python2/3 import test
  include: "{{role_path}}/tasks/python_2_3_test.yml"
  static: yes

- name: Uninstall - Uninstall IPA server
  command: /usr/sbin/ipa-server-install --uninstall -U {% if ipaserver_ignore_topology_disconnect | bool %}--ignore-topology-disconnect{% endif %} {% if ipaserver_ignore_last_of_role | bool %}--ignore-last-of-role{% endif %}
  register: uninstall
  # 2 means that uninstall failed because IPA server was not configured
  failed_when: uninstall.rc != 0 and uninstall.rc != 2
  changed_when: uninstall.rc == 0

#- name: Remove IPA server packages
#  package:
#    name: "{{ item }}"
#    state: absent
#  with_items: "{{ ipaserver_packages }}"
